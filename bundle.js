!function(r){var n={};function i(t){if(n[t])return n[t].exports;var e=n[t]={i:t,l:!1,exports:{}};return r[t].call(e.exports,e,e.exports,i),e.l=!0,e.exports}i.m=r,i.c=n,i.d=function(t,e,r){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:r})},i.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(e,t){if(1&t&&(e=i(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(i.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)i.d(r,n,function(t){return e[t]}.bind(null,n));return r},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="/public",i(i.s=0)}([function(t,e,r){"use strict";function a(t,e,r){if(t<=0||e<=0)throw new Error("Invalid matrix dimensions.");var n=Array.from({length:e},function(){return Array.from({length:t})});if("function"!=typeof r)return{matrix:n,width:t,height:e};for(var i=0;i<e;i++)for(var o=0;o<t;o++)n[i][o]=r(n[i][o],{x:o,y:i},n);return{matrix:n,width:t,height:e}}function s(n){var t=n.length,e=(n[0]||[]).length;if(n.some(function(t){return!Array.isArray(t)||t.length!==e}))throw new Error("Array must have rows of equal lengths.");return a(e,t,function(t,e){var r=e.x,e=e.y;return n[e][r]})}function p(i,o){return a(i.width,i.height,function(t,e,r){var n=e.x,e=e.y;return o(i.matrix[e][n],{x:n,y:e},r)})}function h(t,e){for(var r=0;r<t.height;r++)for(var n=0;n<t.width;n++)e(t.matrix[r][n],{x:n,y:r},t.matrix)}function n(t,e,r,n,i,o){for(var a=p(t,function(t){return t}),s=0;s<e.height;s++)for(var l=0;l<e.width;l++){var u=n.x+l,h=n.y+s,c={x:u,y:h},y=u<0||u>=t.width||h<0||h>=t.height,f=y?r:t.matrix[h][u],g=e.matrix[s][l];if(i(f,g,c))return{matrix:t,merged:!1};y||(a.matrix[h][u]=o(f,g,c))}return{matrix:a,merged:!0}}function l(n){return a(n.height,n.width,function(t,e){var r=e.x,e=e.y;return n.matrix[n.height-r-1][e]})}r.r(e);var i=[{clockwise:[{x:0,y:0},{x:-1,y:0},{x:-1,y:-1},{x:0,y:2},{x:-1,y:2}],counterClockwise:[{x:0,y:0},{x:1,y:0},{x:1,y:1},{x:0,y:-2},{x:1,y:-2}]},{clockwise:[{x:0,y:0},{x:1,y:0},{x:1,y:1},{x:0,y:-2},{x:1,y:-2}],counterClockwise:[{x:0,y:0},{x:-1,y:0},{x:-1,y:-1},{x:0,y:2},{x:-1,y:2}]},{clockwise:[{x:0,y:0},{x:1,y:0},{x:1,y:-1},{x:0,y:2},{x:1,y:2}],counterClockwise:[{x:0,y:0},{x:-1,y:0},{x:-1,y:1},{x:0,y:-2},{x:-1,y:-2}]},{clockwise:[{x:0,y:0},{x:-1,y:0},{x:-1,y:1},{x:0,y:-2},{x:-1,y:-2}],counterClockwise:[{x:0,y:0},{x:1,y:0},{x:1,y:-1},{x:0,y:2},{x:1,y:2}]}];function o(t,e,r){var n={name:t},i=p(s(r),function(t){return t&&n}),o=l(i),r=l(o);return{name:t,rotations:[i,o,r,l(r)],currentState:i,wallKicks:e,value:n}}var u=[o("I",[{clockwise:[{x:0,y:0},{x:-2,y:0},{x:1,y:0},{x:-2,y:1},{x:1,y:-2}],counterClockwise:[{x:0,y:0},{x:2,y:0},{x:-1,y:0},{x:2,y:-1},{x:-1,y:2}]},{clockwise:[{x:0,y:0},{x:-1,y:0},{x:2,y:0},{x:-1,y:-2},{x:2,y:1}],counterClockwise:[{x:0,y:0},{x:1,y:0},{x:-2,y:0},{x:1,y:2},{x:-2,y:-1}]},{clockwise:[{x:0,y:0},{x:2,y:0},{x:-1,y:0},{x:2,y:-1},{x:-1,y:2}],counterClockwise:[{x:0,y:0},{x:-2,y:0},{x:1,y:0},{x:-2,y:1},{x:1,y:-2}]},{clockwise:[{x:0,y:0},{x:1,y:0},{x:-2,y:0},{x:1,y:2},{x:-2,y:-1}],counterClockwise:[{x:0,y:0},{x:-1,y:0},{x:2,y:0},{x:-1,y:-2},{x:2,y:1}]}],[[0,0,0,0],[1,1,1,1],[0,0,0,0],[0,0,0,0]]),o("O",null,[[1,1],[1,1]]),o("T",i,[[0,1,0],[1,1,1],[0,0,0]]),o("S",i,[[0,1,1],[1,1,0],[0,0,0]]),o("Z",i,[[1,1,0],[0,1,1],[0,0,0]]),o("J",i,[[1,0,0],[1,1,1],[0,0,0]]),o("L",i,[[0,0,1],[1,1,1],[0,0,0]])],c=function(r,n){var i,o,a,s={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]},t={next:e(0),throw:e(1),return:e(2)};return"function"==typeof Symbol&&(t[Symbol.iterator]=function(){return this}),t;function e(e){return function(t){return function(e){if(i)throw new TypeError("Generator is already executing.");for(;s;)try{if(i=1,o&&(a=2&e[0]?o.return:e[0]?o.throw||((a=o.return)&&a.call(o),0):o.next)&&!(a=a.call(o,e[1])).done)return a;switch(o=0,(e=a?[2&e[0],a.value]:e)[0]){case 0:case 1:a=e;break;case 4:return s.label++,{value:e[1],done:!1};case 5:s.label++,o=e[1],e=[0];continue;case 7:e=s.ops.pop(),s.trys.pop();continue;default:if(!(a=0<(a=s.trys).length&&a[a.length-1])&&(6===e[0]||2===e[0])){s=0;continue}if(3===e[0]&&(!a||e[1]>a[0]&&e[1]<a[3])){s.label=e[1];break}if(6===e[0]&&s.label<a[1]){s.label=a[1],a=e;break}if(a&&s.label<a[2]){s.label=a[2],s.ops.push(e);break}a[2]&&s.ops.pop(),s.trys.pop();continue}e=n.call(r,s)}catch(t){e=[6,t],o=0}finally{i=a=0}if(5&e[0])throw e[1];return{value:e[0]?e[1]:void 0,done:!0}}([e,t])}}};function y(){}var f=console.log.bind(console);var g={tetrominoGen:function(){var e;return c(this,function(t){switch(t.label){case 0:return e=Math.floor(Math.random()*u.length),[4,u[e]];case 1:return t.sent(),[3,0];case 2:return[2]}})}(),controls:function(t){var e=t.left,r=t.right,n=t.rotateClockwise,i=t.rotateCounterClockwise,o=t.hardDrop,a=t.pause,s=t.softDrop,l=t.hold;function u(t){switch(t.key){case"Shift":case"c":return l();case"ArrowDown":return s(!0);case"ArrowLeft":return e();case"ArrowRight":return r();case"ArrowUp":case"x":return n();case"Control":case"z":return i();case" ":return o();case"Escape":case"F1":return t.preventDefault(),a()}}function h(t){"ArrowDown"===t.key&&s(!1)}return void 0===window?(f("Unable to apply default Tetris keyboard bindings in a non-browser environment. Please provide a callback in the constructor and set up the controls manually."),y):(window.addEventListener("keydown",u),window.addEventListener("keyup",h),function(){window.removeEventListener("keydown",u),window.removeEventListener("keyup",h)})},previewAmount:3};function x(t){this.grid=a(10,20,function(){return 0}),this.holding=void 0,this.canHold=!0,this.gameOver=!1,this.paused=!1,this.softDropping=!1,this._gravityIntervalId=0,this._gravityDelay=0;var e=Object.assign({},g,t);e.render(this),this.tetrominoGen=e.tetrominoGen,this.preview=Array.from({length:e.previewAmount},function(){return e.tetrominoGen.next().value}),this.fallingTetromino=this.nextFallingTetromino(),this.ghost=this.getGhost(this.fallingTetromino),this.applyGravity(),this.gravity=e.gravityDelay,this.originalGravityDelay=e.gravityDelay,this.unloadControls=this.setupControls(e.controls)}Object.defineProperty(x.prototype,"gravity",{get:function(){return this._gravityDelay},set:function(t){var e=this;clearInterval(this._gravityIntervalId),0<t&&(this._gravityIntervalId=setInterval(function(){return e.applyGravity()},t),this._gravityDelay=t)},enumerable:!1,configurable:!0}),x.prototype.setupControls=function(t){var e=this;return t({left:function(){return e.moveTetromino(-1,0)},right:function(){return e.moveTetromino(1,0)},rotateClockwise:function(){return e.rotate(1)},rotateCounterClockwise:function(){return e.rotate(-1)},hardDrop:function(){return e.hardDrop()},pause:function(){return e.pause()},softDrop:function(t){return e.toggleSoftDrop(t)},hold:function(){return e.hold()}})},x.prototype.nextFallingTetromino=function(t){var e=t||this.preview.shift(),r=Math.floor(this.grid.width/2-e.currentState.width/2),n="I"===e.name?-1:-2;return t||this.preview.push(this.tetrominoGen.next().value),{tetromino:e,pos:{x:r,y:n}}},x.prototype.clearLines=function(t){for(var n=t.matrix.reduce(function(t,e,r){return e.every(function(t){return 0!==t})&&t.add(r),t},new Set),e=t.matrix.reduceRight(function(t,e,r){return n.has(r)||t.unshift(e),t},[]);e.length<t.height;)e.unshift(Array.from({length:t.width},function(){return 0}));return s(e)},x.prototype.tryMerge=function(t,e){t=n(this.grid,t.currentState,{},e,function(t,e,r){r=r.y;return 0!==t&&0!==e&&0<=r},function(t,e){return e||t}),e=t.matrix,t=t.merged;return[t,t?this.clearLines(e):e]},x.prototype.moveTetromino=function(t,e){if(this.gameOver||this.paused)return!1;var r=this.fallingTetromino.pos,r=this.tryMerge(this.fallingTetromino.tetromino,{x:r.x+t,y:r.y+e})[0];return r&&(this.fallingTetromino.pos.x+=t,this.fallingTetromino.pos.y+=e,e||(this.ghost=this.getGhost(this.fallingTetromino))),r},x.prototype.applyGravity=function(){var t;this.gameOver||this.paused||this.moveTetromino(0,1)||(this.fallingTetromino.pos.y<=0&&(this.gameOver=!0,this.unloadControls(),f("Game over!")),(t=this.tryMerge(this.fallingTetromino.tetromino,this.fallingTetromino.pos))[0],t=t[1],this.advanceGrid(t))},x.prototype.rotate=function(t){if(!this.gameOver&&!this.paused)for(var e,r,n,i=this.fallingTetromino,o=i.tetromino,a=i.pos,s=o.rotations,l=o.currentState,u=(r=t,n=(e=o).currentState,i=e.rotations,r=(i.indexOf(n)+i.length+r)%i.length,Object.assign({},e,{currentState:i[r]})),l=s.indexOf(l),t=1===t?"clockwise":"counterClockwise",h=0,c=o.wallKicks?o.wallKicks[l][t]:[{x:0,y:0}];h<c.length;h++){var y=c[h],f={x:a.x+y.x,y:a.y+y.y};if(this.tryMerge(u,f)[0])return this.fallingTetromino.tetromino=u,this.fallingTetromino.pos.x+=y.x,this.fallingTetromino.pos.y+=y.y,void(this.ghost=this.getGhost(this.fallingTetromino))}},x.prototype.hold=function(){var t;this.canHold&&(t=this.holding,this.holding=this.fallingTetromino.tetromino,this.fallingTetromino=this.nextFallingTetromino(t),this.ghost=this.getGhost(this.fallingTetromino),this.holding.currentState=this.holding.rotations[0],this.canHold=!1)},x.prototype.toggleSoftDrop=function(t){this.softDropping!==t&&((this.softDropping=t)&&this.applyGravity(),this.gravity=t?this.originalGravityDelay/2:this.originalGravityDelay)},x.prototype.getGhost=function(t){for(var e=t.tetromino,r=t.pos.x,n=t.pos.y;this.tryMerge(e,{x:r,y:n+1})[0];)n+=1;return{tetromino:t.tetromino,pos:{x:r,y:n}}},x.prototype.advanceGrid=function(t){this.grid=t,this.canHold=!0,this.fallingTetromino=this.nextFallingTetromino(),this.ghost=this.getGhost(this.fallingTetromino),this.applyGravity()},x.prototype.hardDrop=function(){if(!this.gameOver&&!this.paused){for(var t=this.fallingTetromino.tetromino,e=this.fallingTetromino.pos.x,r=this.fallingTetromino.pos.y;this.tryMerge(t,{x:e,y:r+1})[0];)r+=1;var n=this.tryMerge(t,{x:e,y:r}),n=(n[0],n[1]);this.advanceGrid(n)}},x.prototype.pause=function(){this.gameOver?this.paused=!1:(this.paused=!this.paused,f("Pause:",this.paused),this.gravity=this.paused?0:this._gravityDelay)},r=x;function d(){}function v(t,e){this.canvas=document.createElement("canvas"),this.context=this.canvas.getContext("2d"),this.parent=null,this.renderFn=d,this.rafId=0,this.width=0,this.height=0,this.width=this.canvas.width=t,this.height=this.canvas.height=e,this.canvas.style.width=this.width+"px",this.canvas.style.height=this.height+"px"}var m=(v.prototype.appendTo=function(t){this.parent||(t.appendChild(this.canvas),this.parent=t)},v.prototype.render=function(t){var e=this;this.renderFn===d&&(this.renderFn=function(){e.context.clearRect(0,0,e.width,e.height),t({ctx:e.context}),requestAnimationFrame(e.renderFn)},this.rafId=requestAnimationFrame(this.renderFn))},v.prototype.stopRendering=function(){this.renderFn!==d&&(cancelAnimationFrame(this.rafId),this.rafId=0,this.renderFn=d)},v);function w(t,e,r,n){var i=r.pos;b(t,e,r.tetromino,i,n)}function b(n,t,e,i,o){n.fillStyle=t.get(e.value),h(e.currentState,function(t,e){var r=e.x,e=e.y;0!==t&&(r=i.x+r,e=i.y+e,n.fillRect(r*o,e*o,o,o))})}function T(t,e,r,n){t.translate(e,r),n(t),t.setTransform(1,0,0,1,0,0)}function k(t,e,r,a,s,l,u){T(t,r.x,r.y,function(){var n,i,o;t.strokeRect(0,0,u*a.width,20*u),w(t,e,s,u),t.globalAlpha=.5,w(t,e,l,u),t.globalAlpha=1,n=t,i=e,o=u,h(a,function(t,e){var r=e.x,e=e.y;0!==t&&(n.fillStyle=i.get(t),n.fillRect(r*o,e*o,o,o))}),function(t,e,r,n){for(var i=1;i<e;i++)t.beginPath(),t.moveTo(i*n,0),t.lineTo(i*n,r*n),t.stroke();for(var o=1;o<r;o++)t.beginPath(),t.moveTo(0,o*n),t.lineTo(e*n,o*n),t.stroke()}(t,a.width,a.height,u)})}var D={I:"cyan",O:"yellow",T:"purple",S:"green",Z:"red",J:"blue",L:"orange"};var G,S,C,e=Math.max(document.documentElement.clientHeight||0,window.innerHeight||0),i=document.getElementById("game-wrapper");function O(t){return t*S}console.log("Hello",i),i&&new r({gravityDelay:200,render:(G=i,S=Math.floor(e/20),function(g){var i,t=O(g.grid.width+12),e=O(g.grid.height),r=O(g.grid.width),t=new m(t,e),e=6*S,p={x:e,y:0},x={x:0,y:0},d={x:e+r,y:0},v=(i=C||D,new Map(Object.keys(i).reduce(function(t,e){var r=u.find(function(t){return t.name===e}),n=i[e];return r&&t.push([r.value,n]),t},[])));t.appendTo(G),t.render(function(t){var e,r,n,i,o,a,s,l,u=t.ctx,h=g.grid,c=g.fallingTetromino,y=g.ghost,f=g.preview,t=g.holding;r=v,n=t,i=S,T(e=u,(t=x).x,t.y,function(){e.strokeRect(0,0,6*i,20*i),n&&b(e,r,n,{x:1,y:1},i)}),k(u,v,p,h,c,y,S),a=v,s=f,l=S,T(o=u,(u=d).x,u.y,function(){o.strokeRect(0,0,6*l,20*l),s.forEach(function(t,e){b(o,a,t,{x:1,y:4*e+1},l)})})})})})}]);
//# sourceMappingURL=bundle.map.js